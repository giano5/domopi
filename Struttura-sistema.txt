Elementi strutturali del sistema
Versione documento: DRAFT

STRUTTURA CARTELLE E FILE
Domopi/	
	bin/
		mod_ident.sh
		lgrcreate.sh
		lgrremove.sh
		lseadd.sh
		lsedel.sh
		lsemod.sh
		mgrcreate.sh
		mgrremove.sh
		mgrmod.sh
		mgradd.sh
		mgrdel.sh
		mgrlist.sh
		
	etc/
		ident.cfg
		localgroup.cfg
		local.cfg
	master/
		modules.cfg
		mastergroup.cfg
		mggroup.cfg
	slave/


TUTTI I MODULI ------------------------------

Identificatore univoco Modulo
	ident.cfg : File contenente le indicazioni
		Nome | ID
(???)		- Il Master NON HA ID (?)
	mod_ident.sh : Script inserimento Nome Modulo e tipo
		Se SLAVE l'ID gli viene assegnato dal MASTER

Descrittore sensori locali
	localgroup.cfg : Raggruppamento Funzionale contenente per ogni riga:
		ID_Gruppo | Nome gruppo univoco | Tipo | Descrizione
			-ove Tipo: LIGHT|NOLIGHT|SWITCH|ALARM|OTHER|PULSE
	local.cfg : File contenente per ogni riga:
		GPIO_ID | Tipo Segnale | Status Iniziale (Se OUTPUT) | ID_GRUPPO | NomeUnivoco | Descrizione
			-ove Tipo Segnale: DIN|DOUT|PWM 
			(DIN/DOUT = Digital IN/OUT (0-5VCC) - PWM (0-5VCC in 1024 steps)

	Funzioni per la gestione
		(LocalGRoupCreate)
		lgrcreate.sh : Creazione di un gruppo
		lgrremove.sh : Eliminazione gruppo
			- Solo se vuoto
		(LocalSEnsorAdd)
		lseadd.sh : Inserimento sensore (possibilmente a partire dai nomi degli oggetti)
			- Evitare duplicazioni
			- Associazione ad un gruppo
		lsedel.sh : Eliminazione sensore (possibilmente a partire dal nome)
		lsemod.sh : Modifica sensore (possibilmente a partire dal nome)
			- Cambiamento appartenenza ad un gruppo

------------------------------------------------------------------

MODULO MASTER ------------------------

Moduli attivi
	modules.cfg : File contenente per ogni riga
		ID_Modulo | Indirizzo (?) | Nome | Descrizione

	(( 	
		Scambio chiavi ssh all'inizializzazione
		Trasferimento info via SCP
	))
	Acquisizione nuovo modulo
		Identificazione modulo
		Assegnazione ID_Modulo
		Connessione
		Ricezione file dei descrittori remoti (Sensori e Gruppi)		

Gruppi master
	mastergroup.cfg : File contenente per ogni riga (contiene i gruppi master che poi raggrupperanno
							i sensori locali, quelli remoti o gruppi locali)
		ID_GRUPPOM | Nome Gruppo M | Descrizione
	mgrcreate.sh : Inserimento Gruppo Master
	mgrremove.sh : Eliminiazione Gruppo Master
		- Solo se vuoto
	mgrmod.sh : Modifica Descrizione Gruppo Master
	mggroup.cfg : File contenente (l'assegnazione tra gruppi e sensori locali, gruppi e sensori remoti
					in mastergroup)
		Tipo(S/G) | Posizione (L/R) | ID (Sen/Gr) | ID_MASTER
	mgradd.sh : Aggiunta Gruppo Locale o Sensore a Gruppo Master
	mgrdel.sh : Rimozione Gruppo Locale da Gruppo Master
	mgrlist.sh : Elenco Assegnazioni , Elenco Gruppi Master
	
Descrittore completo 
	File informazioni completo contenente per ogni riga:
		Descrittore remoto con un campo in più 
		ID_MODULO | ... resto della riga 
			GPIO_ID | Tipo Segnale | Status Iniziale (Se OUTPUT) | ID_GRUPPO | NomeUnivoco | Descrizione

Comunicazione con il Master


------------------------------------------------------

		
Funzioni localizzate
	Timer periodico (granularità al minuto (?))
		File contenente per ogni riga
			GRUPPO_ID | GPIO_ID oppure * | Giorno Sett oppure * | HH:MM On | HH:MM Off
				-granularità al minuto (?)
		Script periodica di controllo
			Scansione del file per verificare lo status da applicare
				(aggiorno/verifico tutti gli stati)

	Eventi condizionati / Trigger (Granularità ?)
		File contenente per ogni riga
			GRUPPO_ID | GPIO_ID oppure * | Funzione T/F oppure # 
				-ove Funzione T/F è una script o un comando che restituisce True/False
			Script periodica di controllo
				Scansione del file per verificare lo status da applicare
					(aggiorno tutti gli stati o cambio quelli variati?)

	oppure
		File contenente l'elenco delle script da eseguire e loro stato
		Compilazione di una script specifica per ogni elemento per l'esecuzione elettronica degli stati.
		Gestione della esecuzione costante di tali script dall'analisi del file di elenco
		"WAIT" interno alla script per granularità timing (X secondi).



			


